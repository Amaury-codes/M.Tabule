(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(e){if(e.ep)return;e.ep=!0;const i=o(e);fetch(e.href,i)}})();function D(t,n){return window.go.main.App.ConfirmDialog(t,n)}function C(t){return window.go.main.App.DeleteProfile(t)}function P(){return window.go.main.App.ListProfiles()}function F(t){return window.go.main.App.LoadProfile(t)}function k(t,n,o){return window.go.main.App.ProcessFiles(t,n,o)}function A(t){return window.go.main.App.SaveProfile(t)}function O(){return window.go.main.App.SelectAndReadTestFile()}function M(){return window.go.main.App.SelectDirectory()}const p=["#4e73df","#1cc88a","#36b9cc","#f6c23e","#e74a3b","#858796","#5a5c69"];let m=[],f=null,E="";function g(t,n){const o=t==="success"?"success-alert":"warning-alert",r=t==="success"?"success-alert-message":"warning-alert-message";document.getElementById(r).textContent=n;const e=document.getElementById(o);e.classList.remove("d-none"),setTimeout(()=>e.classList.add("d-none"),5e3)}function y(t,n,o){let r=t||"";return n>0&&r.length>n&&(r=r.substring(n)),o>0&&r.length>o&&(r=r.substring(0,r.length-o)),r.trim()}async function R(){try{const t=await O();if(t==null)return;E=t,document.getElementById("testFilePath").placeholder="Fichier de test chargé",b()}catch(t){alert(`Erreur de sélection : ${t}`)}}function b(){if(!E){document.getElementById("preview").innerHTML=`<span class="text-muted">(Chargez un fichier pour voir l'aperçu)</span>`,m=[],u();return}const t=E.split(`
`)[0].trim(),n=document.getElementById("separator").value;m=t.split(n);const o=document.getElementById("preview");if(o.innerHTML="",t===""){o.textContent="(Fichier vide)",u();return}m.forEach((r,e)=>{const i=document.createElement("span");i.className="tag",i.style.backgroundColor=p[e%p.length],i.textContent=r.trim(),i.setAttribute("draggable","true"),i.dataset.originalIndex=e,i.ondragstart=s=>{s.dataTransfer.setData("application/json",JSON.stringify({text:r.trim(),index:e,color:p[e%p.length]}))},o.appendChild(i)}),u()}function h(t){const o=[...document.getElementById("extractZone").children].map(r=>{var s;const e=!!r.dataset.fusionRule,i={isFusion:e,columnName:((s=r.querySelector(".column-name-input"))==null?void 0:s.value)||"sans_nom",originalText:r.querySelector(".original-text").textContent};return e?i.fusionRule=JSON.parse(r.dataset.fusionRule):(i.originalIndex=parseInt(r.dataset.originalIndex),i.prefixTrim=parseInt(r.dataset.prefixTrim||"0"),i.suffixTrim=parseInt(r.dataset.suffixTrim||"0")),i});return{name:t,separator:document.getElementById("separator").value,columns:o,recursive:document.getElementById("recursiveSwitch").checked,outputMode:document.querySelector('input[name="outputMode"]:checked').value,saveLocation:document.querySelector('input[name="saveLocation"]:checked').value,autoDetectEnabled:document.getElementById("autoDetectEnabledSwitch").checked,autoDetectIndex:parseInt(document.getElementById("autoDetectIndex").value)-1,autoDetectValue:document.getElementById("autoDetectValue").value.trim()}}function q(t){document.getElementById("profileName").value=t.name,document.getElementById("separator").value=t.separator;const n=document.getElementById("recursiveSwitch");n.checked=t.recursive||!1,n.dispatchEvent(new Event("change")),t.outputMode?document.querySelector(`input[name="outputMode"][value="${t.outputMode}"]`).checked=!0:document.getElementById("outputSingleFile").checked=!0,t.saveLocation?document.querySelector(`input[name="saveLocation"][value="${t.saveLocation}"]`).checked=!0:document.getElementById("saveLocationPrompt").checked=!0;const o=document.getElementById("autoDetectEnabledSwitch");o.checked=t.autoDetectEnabled||!1,o.dispatchEvent(new Event("change")),document.getElementById("autoDetectIndex").value=(t.autoDetectIndex!==void 0?t.autoDetectIndex:0)+1,document.getElementById("autoDetectValue").value=t.autoDetectValue||"";const r=document.getElementById("extractZone");r.innerHTML="",t.columns&&t.columns.forEach(e=>{const i=e.originalIndex>=0?p[e.originalIndex%p.length]:"#858796",s=x(e.originalText,e.originalIndex,!0,i);if(s.querySelector(".column-name-input").value=e.columnName,e.isFusion)s.dataset.fusionRule=JSON.stringify(e.fusionRule);else{s.dataset.prefixTrim=e.prefixTrim||0,s.dataset.suffixTrim=e.suffixTrim||0;const a=s.querySelector(".tag-settings");a&&(a.querySelector(".trim-input-prefix").value=e.prefixTrim||0,a.querySelector(".trim-input-suffix").value=e.suffixTrim||0)}r.appendChild(s)})}async function Z(){const n=document.getElementById("profileName").value.trim();if(!n){alert("Veuillez donner un nom à votre profil.");return}const o=h(n);if(o.columns.length===0){alert("Impossible de sauvegarder un profil vide.");return}try{if((await P()).includes(n)&&await D("Remplacer le profil ?",`Un profil nommé "${n}" existe déjà. Voulez-vous le remplacer ?`)!=="Supprimer")return;await A(JSON.stringify(o)),f=n,await v(),document.getElementById("profileSelector").value=n,g("success",`Le profil "${n}" a été sauvegardé !`)}catch(r){console.error("Erreur sauvegarde profil:",r),alert(`Erreur de sauvegarde : ${r}`)}}async function $(){const n=document.getElementById("profileSelector").value;if(!n){f=null;return}try{const o=await F(n),r=JSON.parse(o);q(r),f=r.name,u(),g("success",`Profil "${n}" chargé.`)}catch(o){f=null,console.error("Erreur chargement profil:",o),alert(`Erreur de chargement : ${o}. Ce profil n'existe peut-être plus.`),await v()}}async function V(){const n=document.getElementById("profileSelector").value;if(!n){alert("Veuillez sélectionner un profil à supprimer.");return}try{if(await D("Confirmation",`Supprimer le profil "${n}" ?`)!=="Supprimer")return;const r=await C(n);r.success?(g("success",r.message),document.getElementById("profileName").value="",document.getElementById("extractZone").innerHTML="",f===n&&(f=null),await v(),u()):alert(`Échec suppression : ${r.message}`)}catch(o){console.error("Erreur suppression:",o),alert("Erreur inattendue.")}}async function v(){const t=document.getElementById("profileSelector"),n=t.value;t.innerHTML='<option value="">-- Aucun profil sélectionné --</option>';try{const o=await P()||[];o.sort((e,i)=>e.localeCompare(i)).forEach(e=>{const i=document.createElement("option");i.value=e,i.textContent=e,t.appendChild(i)});const r=o.find(e=>e===n);t.value=r?n:""}catch(o){console.error("Erreur liste profils:",o),alert("Erreur: Impossible de lister les profils.")}}function J(){const t=document.getElementById("fusionZone"),n=[...t.children];if(n.length<2){alert("Glissez au moins deux données.");return}const o=document.getElementById("fusionSeparator").value||" ",r={separator:o,parts:[]},e=[];n.forEach(a=>{const c={originalIndex:parseInt(a.dataset.originalIndex),prefix:parseInt(a.dataset.prefixTrim||"0"),suffix:parseInt(a.dataset.suffixTrim||"0")};r.parts.push(c);const l=m[c.originalIndex]||"";e.push(y(l,c.prefix,c.suffix))});const i=e.join(o),s=x(i,-1,!0,"#858796");s.dataset.fusionRule=JSON.stringify(r),s.querySelector(".column-name-input").value="colonne_fusionnee",document.getElementById("extractZone").appendChild(s),t.innerHTML="",u()}async function H(){const t=document.getElementById("status"),n=document.getElementById("sourceDirectoryPath").value;if(!n){alert("Veuillez sélectionner un dossier de fichiers TXT.");return}const o=document.getElementById("globalAutoDetectSwitch").checked;let r="{}";if(!o){const e=h("current_run");if(e.columns.length===0){alert("Veuillez définir au moins une colonne à extraire ou activer l'auto-détection.");return}r=JSON.stringify(e)}t.textContent=o?"Recherche des profils...":"Traitement en cours...";try{const e=await k(r,n,o);t.textContent=e,g("success",e)}catch(e){t.textContent=`Erreur : ${e}`,g("warning",`Une erreur est survenue : ${e}`)}}function L(t){t.preventDefault()}function T(t){t.preventDefault();const n=t.target.closest(".droppable");if(!n)return;const o=JSON.parse(t.dataTransfer.getData("application/json")),r=x(o.text,o.index,!0,o.color);n.id!=="extractZone"&&(r.querySelector(".column-name-input").style.display="none"),n.appendChild(r),n.id==="extractZone"&&u()}function x(t,n,o,r){const e=document.createElement("div");e.className="tag",e.dataset.originalIndex=n,e.dataset.prefixTrim="0",e.dataset.suffixTrim="0",e.style.backgroundColor=r||"#5a5c69";const i=document.createElement("span");i.textContent=t,i.className="original-text",e.appendChild(i);{const a=document.createElement("input");a.type="text",a.className="column-name-input",a.placeholder="Nom colonne...",a.value=t.substring(0,20),a.onclick=d=>d.stopPropagation(),a.oninput=u,e.appendChild(a);const c=document.createElement("span");c.textContent="⚙️",c.title="Rognage",c.style.cursor="pointer",c.style.marginLeft="4px";const l=document.createElement("div");l.className="tag-settings",l.innerHTML='<button class="close-settings" title="Fermer">×</button><label>Début</label><input type="number" value="0" min="0" class="trim-input-prefix"><label>Fin</label><input type="number" value="0" min="0" class="trim-input-suffix">',c.onclick=d=>{d.stopPropagation(),l.style.display=l.style.display==="flex"?"none":"flex"},l.querySelector(".close-settings").onclick=d=>{d.stopPropagation(),l.style.display="none"};const I=l.querySelector(".trim-input-prefix"),w=l.querySelector(".trim-input-suffix"),B=()=>{const d=parseInt(I.value)||0,S=parseInt(w.value)||0;e.dataset.prefixTrim=d,e.dataset.suffixTrim=S;const N=m[parseInt(e.dataset.originalIndex)]||"";i.textContent=y(N,d,S),u()};I.addEventListener("input",B),w.addEventListener("input",B),e.appendChild(c),e.appendChild(l)}const s=document.createElement("span");return s.textContent="✖",s.title="Supprimer",s.style.cursor="pointer",s.style.marginLeft="4px",s.onclick=()=>{e.remove(),u()},e.appendChild(s),e}function u(){const t=document.getElementById("csvPreview"),n=h("preview");if(n.columns.length===0||m.length===0){t.innerHTML='<span class="text-muted">(Configurez des colonnes et un fichier test)</span>';return}const o=n.columns.map(e=>`"${e.columnName.replace(/"/g,'""')}"`),r=n.columns.map(e=>{let i;return e.isFusion?i=e.fusionRule.parts.map(a=>y(m[a.originalIndex]||"",a.prefix,a.suffix)).join(e.fusionRule.separator):i=y(m[e.originalIndex]||"",e.prefixTrim,e.suffixTrim),`"${i.replace(/"/g,'""')}"`});t.innerHTML=`<pre>${o.join(";")}
${r.join(";")}</pre>`}async function z(){try{const t=await M();t&&(document.getElementById("sourceDirectoryPath").value=t)}catch(t){console.error("Erreur sélection dossier:",t)}}async function j(){document.getElementById("browseTestFileBtn").addEventListener("click",R),document.getElementById("autoDetectEnabledSwitch").addEventListener("change",o=>{document.getElementById("autoDetectOptions").classList.toggle("d-none",!o.target.checked)}),document.getElementById("separator").addEventListener("change",b),document.getElementById("browseBtn").addEventListener("click",z),document.getElementById("saveProfileBtn").addEventListener("click",Z),document.getElementById("loadProfileBtn").addEventListener("click",$),document.getElementById("deleteProfileBtn").addEventListener("click",V),document.getElementById("createFusionBtn").addEventListener("click",J),document.getElementById("processFilesBtn").addEventListener("click",H);const t=document.getElementById("extractZone"),n=document.getElementById("fusionZone");t.addEventListener("drop",T),t.addEventListener("dragover",L),n.addEventListener("drop",T),n.addEventListener("dragover",L),document.getElementById("recursiveSwitch").addEventListener("change",o=>{document.getElementById("outputModeOptions").classList.toggle("d-none",!o.target.checked)}),await v(),u()}document.addEventListener("DOMContentLoaded",j);
